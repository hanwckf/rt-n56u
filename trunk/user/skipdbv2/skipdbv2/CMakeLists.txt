PROJECT(skipdbv2)
CMAKE_MINIMUM_REQUIRED (VERSION 2.8)
ADD_DEFINITIONS(-Os -g -Wstrict-prototypes -Wall  -falign-loops=16 -DBUILDING_SKIPDB_DLL)

SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
SET(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
set(LIBEV_LIBRARIES CACHE PATH "Path to the libev library")
set(LIBEV_INCLUDE_DIRS ${PROJECT_SOURCE_DIR}/libev)

#INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/src)

if ("${LIBEV_INCLUDE_DIRS}" STREQUAL "")
set(LIBEV_LIBRARIES ev)
endif()

INCLUDE_DIRECTORIES(${LIBEV_INCLUDE_DIRS} ${PROJECT_SOURCE_DIR}/basekit/simd_cph/include ${PROJECT_SOURCE_DIR}/basekit ${PROJECT_SOURCE_DIR}/jfile ${PROJECT_SOURCE_DIR}/udb ${PROJECT_SOURCE_DIR}/skipdb)
FILE(GLOB_RECURSE BASEKIT_SRC ${PROJECT_SOURCE_DIR}/basekit/*.c)
FILE(GLOB_RECURSE FILE_SRC ${PROJECT_SOURCE_DIR}/jfile/*.c)
FILE(GLOB_RECURSE UDB_SRC ${PROJECT_SOURCE_DIR}/udb/*.c)
FILE(GLOB_RECURSE SKIPDB_SRC ${PROJECT_SOURCE_DIR}/skipdb/*.c)
FILE(GLOB_RECURSE MGR_SRC ${PROJECT_SOURCE_DIR}/mgr/*.c)
FILE(GLOB_RECURSE CLIENT_SRC ${PROJECT_SOURCE_DIR}/client/*.c)

#set(CMAKE_LIBRARY_PATH ${CMAKE_LIBRARY_PATH} /opt/brcm-arm/usr/lib)

ADD_LIBRARY(skipdb STATIC ${BASEKIT_SRC} ${FILE_SRC} ${UDB_SRC} ${SKIPDB_SRC})

#INCLUDE_DIRECTORIES(${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(test ./tests/test.c)
#TARGET_LINK_LIBRARIES(test skipdb m ${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(test2 ./tests/test2.c)
#TARGET_LINK_LIBRARIES(test2 skipdb m ${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(jftest ./tests/jftest.c)
#TARGET_LINK_LIBRARIES(jftest skipdb m ${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(udbtest ./tests/udbtest.c)
#TARGET_LINK_LIBRARIES(udbtest skipdb m ${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(example ./tests/example.c)
#TARGET_LINK_LIBRARIES(example skipdb m ${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(skiplist ./tests/skiplist)

ADD_EXECUTABLE(skipd ${PROJECT_SOURCE_DIR}/mgr/skipd.c ${PROJECT_SOURCE_DIR}/mgr/daemonize.c)
TARGET_LINK_LIBRARIES(skipd skipdb m ${LIBEV_LIBRARIES})

ADD_EXECUTABLE(dbus ${PROJECT_SOURCE_DIR}/mgr/dbus.c)
TARGET_LINK_LIBRARIES(dbus ${LIBEV_LIBRARIES})

ADD_EXECUTABLE(dbapi ${PROJECT_SOURCE_DIR}/mgr/dbapi.c)
TARGET_LINK_LIBRARIES(dbapi ${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(env ${PROJECT_SOURCE_DIR}/tests/env.c)
#TARGET_LINK_LIBRARIES(env ${LIBEV_LIBRARIES})

#ADD_EXECUTABLE(server ${PROJECT_SOURCE_DIR}/mgr/array-heap.c ${PROJECT_SOURCE_DIR}/mgr/unix-echo-server.c)
#ADD_EXECUTABLE(client ${PROJECT_SOURCE_DIR}/mgr/array-heap.c ${PROJECT_SOURCE_DIR}/mgr/unix-echo-client.c)
#TARGET_LINK_LIBRARIES(server skipdb m ${LIBEV_LIBRARIES})
#TARGET_LINK_LIBRARIES(client skipdb m ${LIBEV_LIBRARIES})

ADD_EXECUTABLE(skbus ${CLIENT_SRC})
TARGET_LINK_LIBRARIES(skbus m ${LIBEV_LIBRARIES})
